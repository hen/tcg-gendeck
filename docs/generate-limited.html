<html>
    <head>
        <title>Generate Limited Deck</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    </head>

    <body>
        <h1>Generated Wave 3 Pack</h1>

        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

        <script>
            $.getJSON( "https://hen.github.io/tcg-gendeck/json/bot-cards.json", function( data ) {
              var wave3 = [];
              var wave3_small = [];

//  Wave 1:    Super Rare is 1:79
//  Wave 1:    
//  Wave 2:    Combiner is 1:2  (not really useful)
//  Wave 2:    
//  Wave 3:    Super Rare is 1:50, Uncommon-Small is 1:5.
//  Wave 3:    Rare is? 1:10?  Uncommon is?  1:3?
//  Wave 4:    Super Rare is 1:50, Uncommon-Small is 1:3.    (1:3 means 1 X card for every 3 Y cards; I think)
//  Wave 4:    Rare is?   Uncommon is?

              var wave3_small_ratios = [1, 4];    // Equivalent of 1:3
              var wave3_ratios = [1, 53, 72, 80];   // Equivalent-ish of 1:(79/3):(79/10):79
              var rarities = ['Common', 'Uncommon', 'Rare', 'Super-Rare']

              rarity_random = Math.ceil(Math.random() * 4);   // replace 4 with max of ratios
              var chosen_small_rarity = '';
              $.each( wave3_small_ratios, function( idx, ratio ) {
                if(rarity_random >= ratio) {
                  chosen_small_rarity = rarities[idx]
                }
              });

              rarity_random = Math.ceil(Math.random() * 80);   // replace 80 with max of ratios
              var chosen_rarity = '';
              $.each( wave3_ratios, function( idx, ratio ) {
                if(rarity_random >= ratio) {
                  chosen_rarity = rarities[idx]
                }
              });

              $.each( data.records, function( idx, card ) {
                if(card.fields.Set=='Wave 3') {
                  var small = false;
                  if(card.fields['Alt Type(s)']) {
                    if(card.fields['Alt Type(s)'].includes('Battle Master')) {
                      small = true;
                    }
                    if(card.fields.Tribe) {
                      $.each( card.fields.Tribe, function( idx, tribe ) {
                        if( tribe.endsWith('Patrol') ) {
                          small = true;
                          return;
                        }
                      });
                    }
                    if(small) {
                      if(card.fields.Rarity==chosen_small_rarity) {
                        wave3_small.push(card);
                      }
                    } else {
                      if(card.fields.Rarity==chosen_rarity) {
                        wave3.push(card);
                      }
                    }
                  }
                }
              });

              var chosen=wave3[Math.floor(Math.random() * wave3.length)];
              var img_index=0;
              if(chosen.fields['Alt Type(s)']) {
                if(chosen.fields['Alt Type(s)'].includes('Weaponizer')) {
                  img_index=1;
                }
              }
              chosen_item="<li style='display: inline' id='" + chosen.id + "'><img width='375' height='525' src='" + chosen.fields['Image(s)'][img_index].thumbnails.large.url + "'/>";
                //  For alt:   + chosen.fields.Set + ": " + chosen.fields.Name + "</li>" );

              $( chosen_item ).appendTo( "#bot_cards" );


              chosen=wave3_small[Math.floor(Math.random() * wave3_small.length)];
              img_index=0;
              if(chosen.fields['Alt Type(s)']) {
                if(chosen.fields['Alt Type(s)'].includes('Battle Master')) {
                  img_index=1;
                }
              }
              chosen_item="<li style='position: absolute; left: 500; top:70;z-index: -1;' class='small_card' id='" + chosen.id + "'><img width='250' height='350' src='" + chosen.fields['Image(s)'][img_index].thumbnails.large.url + "'/>";
                //  For alt:   + chosen.fields.Set + ": " + chosen.fields.Name + "</li>" );

              $( chosen_item ).appendTo( "#battle_cards" );

            });


            $.getJSON( "https://hen.github.io/tcg-gendeck/json/battle-cards.json", function( data ) {
              var wave3 = [];
              wave3['Common'] = [];
              wave3['Uncommon'] = [];
              wave3['Rare'] = [];
              $.each( data.records, function( idx, card ) {
                  if(card.fields.Set=='Wave 3') {
                    wave3[card.fields.Rarity].push(card);
                  }
              });

              var chosen = [];

              for (i = 0; i < 3; i++) {
                var rnd = Math.floor(Math.random() * wave3['Common'].length);
                chosen.push( wave3['Common'][rnd] );
                wave3['Common'].splice( rnd, 1 );
              }
              for (i = 0; i < 2; i++) {
                var rnd = Math.floor(Math.random() * wave3['Uncommon'].length);
                chosen.push( wave3['Uncommon'][rnd] );
                wave3['Common'].splice( rnd, 1 );
              }
              chosen.push( wave3['Rare'][Math.floor(Math.random() * wave3['Rare'].length)] );

              var li_items = [];

              var drop_distance = 120;      // This needs to be different for wave 1/2

              $.each( chosen, function( idx, card ) {
                li_items.push( "<li style='position: absolute; left: 500; top: " + drop_distance + ";' class='small-card' id='" + card.id + "'><img width='250' height='350' src='" + card.fields['Image'][0].thumbnails.large.url + "'/>");
                //  For alt:   + card.fields.Set + ": " + card.fields.Name + "</li>" );
                drop_distance += 55;
              });

              $( li_items.join( "" ) ).appendTo( "#battle_cards" );
            });
        </script>

        <style>
          .small-card { float: left; }
          ul { list-style: none; }
          #battle_cards li { }
        </style>

        <ul>
          <li>
            <ul id="bot_cards">
            </ul>
          </li>
          <li>
            <ul id="battle_cards">
            </ul>
          </li>
        </ul>

    </body>
</html>
